<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head>
        <title>Listagem de produtos da NFE</title>
    </h:head>
    <h:body>
        <ui:include src="../menu.xhtml" />
        <p:panel>
            <h:form id="nfe">
                <h:panelGrid columns="2">
                    <h:outputText value="Frete" />
                    <p:inputText id="frete" value="#{nfController.notaFiscal.frete}">
                        <p:ajax event="keyup" update=":nfe:nfeProdutos" listener="#{nfController.notaFiscal.atualizarPrecos()}" />
                    </p:inputText>
                    <h:outputText value="Fronteira" />
                    <p:inputText id="fronteira" value="#{nfController.notaFiscal.fronteira}">
                        <p:ajax event="keyup" update=":nfe:nfeProdutos" listener="#{nfController.notaFiscal.atualizarPrecos()}" />
                    </p:inputText>
                </h:panelGrid>
                <p:dataTable id="nfeProdutos" rowIndexVar="rowId" var="produto" value="#{nfController.notaFiscal.produtos}">
                    <p:column headerText="Código">
                        <h:outputText value="#{produto.codigo}" />
                    </p:column>
                    <p:column headerText="Quantidade">
                        <h:outputText value="#{produto.quantidadeEstoque}" />
                    </p:column>
                    <p:column headerText="Descrição">
                        <h:outputText value="#{produto.descricao}" />
                    </p:column>
                    <p:column headerText="Valor de compra">
                        <h:outputText value="#{produto.valorUnitario}" />
                    </p:column>
                    <p:column headerText="ICMS">
                        <p:inputText value="#{produto.aliquotaICMS}" >
                            <p:ajax event="keyup" update="valorUnitarioVenda margemContribuicao" listener="#{produto.calcularValorVenda}" />
                        </p:inputText>
                    </p:column>
                    <p:column headerText="IPI">
                        <h:outputText value="#{produto.aliquotaIPI}" />
                    </p:column>
                    <p:column headerText="Valor de venda">
                        <p:inputText id="valorUnitarioVenda" value="#{produto.valorUnitarioVenda}">
                            <p:ajax event="keyup" update="margemContribuicao" listener="#{produto.calcularMargemContribuicao}" />
                        </p:inputText>
                    </p:column>
                    <p:column headerText="Margem de contribuição (%)">
                        <h:outputText id="margemContribuicao" value="#{produto.margemContribuicao}" />
                    </p:column>
                </p:dataTable>
                <h:commandButton action="${nfController.salvar()}" value="Salvar" />
            </h:form>
        </p:panel>
    </h:body>
</html>

